{"ast":null,"code":"import { createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-34dfbcf2\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  slot: \"header\",\n  class: \"clearfix\"\n}, [/*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"el-icon-s-promotion\"\n}), /*#__PURE__*/_createElementVNode(\"span\", {\n  style: {\n    \"margin-left\": \"10px\",\n    \"font-size\": \"18px\"\n  }\n}, \"NDSI预测\")], -1 /* HOISTED */));\nconst _hoisted_2 = {\n  style: {\n    \"text-align\": \"center\",\n    \"margin-bottom\": \"12px\"\n  }\n};\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"el-icon-upload\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"el-upload__text\"\n}, [/*#__PURE__*/_createTextVNode(\"将文件拖到此处，或\"), /*#__PURE__*/_createElementVNode(\"em\", null, \"点击上传\")], -1 /* HOISTED */));\nconst _hoisted_5 = {\n  style: {\n    \"text-align\": \"center\",\n    \"height\": \"10%\"\n  }\n};\nconst _hoisted_6 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"el-icon-upload el-icon--right\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_7 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"el-icon-download el-icon--right\"\n}, null, -1 /* HOISTED */));\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_upload = _resolveComponent(\"el-upload\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  return _openBlock(), _createBlock(_component_el_card, {\n    class: \"box-card\",\n    style: {\n      \"width\": \"40%\",\n      \"margin-top\": \"20vh\",\n      \"margin-left\": \"25vw\"\n    }\n  }, {\n    default: _withCtx(() => [_hoisted_1, _createElementVNode(\"div\", _hoisted_2, [_createVNode(_component_el_upload, {\n      class: \"upload-demo\",\n      action: \"#\",\n      drag: \"\",\n      limit: 2,\n      multiple: \"\",\n      \"auto-upload\": false,\n      \"file-list\": $data.fileList,\n      \"on-remove\": $options.handleRemove,\n      \"on-change\": $options.handleChange\n    }, {\n      default: _withCtx(() => [_hoisted_3, _hoisted_4]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"file-list\", \"on-remove\", \"on-change\"])]), _createElementVNode(\"div\", _hoisted_5, [_createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: $options.submit\n    }, {\n      default: _withCtx(() => [_createTextVNode(\"上传待预测影像\"), _hoisted_6]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"onClick\"]), _createVNode(_component_el_button, {\n      type: \"primary\",\n      onClick: $options.download\n    }, {\n      default: _withCtx(() => [_createTextVNode(\"下载预测标签文件\"), _hoisted_7]),\n      _: 1 /* STABLE */\n    }, 8 /* PROPS */, [\"onClick\"])])]),\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["_createElementVNode","slot","class","style","_createBlock","_component_el_card","_hoisted_1","_hoisted_2","_createVNode","_component_el_upload","action","drag","limit","multiple","$data","fileList","$options","handleRemove","handleChange","_hoisted_3","_hoisted_4","_hoisted_5","_component_el_button","type","onClick","submit","_hoisted_6","download","_hoisted_7"],"sources":["H:\\bs\\SpringBoot+Vue\\springboot-vue-demo\\vue\\src\\views\\Assistance.vue"],"sourcesContent":["<template>\r\n\r\n  <el-card class=\"box-card\" style=\"width: 40%;  margin-top: 20vh;margin-left: 25vw; \" >\r\n\r\n    <div slot=\"header\" class=\"clearfix\">\r\n      <i class=\"el-icon-s-promotion\"></i>\r\n      <span style=\"margin-left: 10px; font-size: 18px;\">NDSI预测</span>\r\n    </div>\r\n\r\n    <div style=\"text-align: center; margin-bottom:12px; \">\r\n      <el-upload\r\n          class=\"upload-demo\"\r\n          action=\"#\"\r\n          drag\r\n          :limit=\"2\"\r\n          multiple\r\n          :auto-upload=\"false\"\r\n          :file-list=\"fileList\"\r\n          :on-remove=\"handleRemove\"\r\n          :on-change=\"handleChange\">\r\n        <i class=\"el-icon-upload\"></i>\r\n        <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\r\n      </el-upload>\r\n    </div>\r\n\r\n    <div style=\" text-align: center; height: 10%;\">\r\n      <el-button type=\"primary\"  @click=\"submit\">上传待预测影像<i class=\"el-icon-upload el-icon--right\"></i></el-button>\r\n      <el-button type=\"primary\"  @click=\"download\">下载预测标签文件<i class=\"el-icon-download el-icon--right\"></i></el-button>\r\n    </div>\r\n\r\n\r\n\r\n\r\n\r\n  </el-card>\r\n</template>\r\n\r\n\r\n<script>\r\n// import { getTrainStatus} from '../api/train-record'\r\nimport request from \"@/utils/request\";\r\nexport default {\r\n  name:'iceRange',\r\n  data(){\r\n    return {\r\n\r\n\r\n      fileList: [],\r\n      dialogVisible: false,\r\n      tifUrlList:\"\",\r\n      //因为一次只上传一张图片预测，只获取一个文件名\r\n      fileName:\"\"\r\n    }\r\n  },\r\n  methods: {\r\n\r\n    //将每次图片数组变化的时候，实时的进行监听，更改数组里面的图片数据, fileList是上传的图片\r\n    handleChange(file, fileList) {\r\n      var array = [];\r\n      fileList.forEach((item) => {\r\n        array.push(item.raw);\r\n      });\r\n      //赋值给fileList\r\n      this.fileList = array;\r\n      //获取文件名，下载时候需要文件名\r\n      this.fileName = fileList[0].name\r\n      console.log(this.fileName, \"文件名\")\r\n\r\n\r\n    },\r\n    //文件列表移除文件时的钩子\r\n    handleRemove(file, fileList) {\r\n      this.fileList = fileList\r\n    },\r\n\r\n    //上传原始影像\r\n    submit() {\r\n      //首先判断训练状态训练状态，\r\n      // getTrainStatus().then(( trainFlag ) => {\r\n      //     //如果当前U-Net模型正在训练中\r\n      //     if(trainFlag.data.data.train_over == false && trainFlag.data.data.train_model == \"U-Net\") {\r\n      //         this.$message({\r\n      //                 message: \"当前U-Net模型正在训练中，请等待训练完成后再使用U-Net模型预测\",\r\n      //                 type: 'warning',\r\n      //                 showClose:true,\r\n      //                 //停留15秒\r\n      //                 duration:15000,\r\n      //             });\r\n      //     }\r\n      //     //如果U-Net不在训练中\r\n      //     else {\r\n\r\n\r\n\r\n\r\n      const formData = new FormData();\r\n      // 首先判断是否上传了图片，如果上传了图片，将图片存入到formData中\r\n      // console.log(this.fileList, \"submit方法里的this.fileList是空吗\");\r\n      //空数组被布尔类型判断不为空\r\n      // console.log(this.fileList == null, \"空数组是否为null\");\r\n      if (this.fileList.length != 0) {\r\n        //传给后台接收的文件名字,只传一张\r\n        formData.append(\"band5\" ,this.fileList[0])\r\n        formData.append(\"band19\", this.fileList[1])\r\n        this.$message({type: 'success', message: '提交成功，请等待预测结果'});\r\n        //提交表单\r\n\r\n         request.post(\"/bx/ndsi/download\",formData)\r\n            .then((response) => {\r\n              if (response.status === 200) {\r\n                // 请求成功，处理响应数据\r\n                this.$message({ type: 'success', message: '预测成功，请下载预测标签！' });\r\n                this.tifUrlList = response.data.data.ndsi_result_url;\r\n              } else {\r\n                // 请求成功，但服务器返回错误状态码\r\n                console.error('请求成功，但服务器返回错误状态码:', response.status);\r\n                this.$message({ type: 'warning', message: '提交失败!' });\r\n              }\r\n            })\r\n            .catch((error) => {\r\n              // 请求失败，打印错误信息\r\n              console.error('请求失败:', error);\r\n              // 这里可以根据错误类型显示不同的错误提示\r\n              this.$message({ type: 'error', message: '请求失败，请检查网络或稍后重试。' });\r\n            });\r\n      }\r\n      else {\r\n        this.$message({type: 'warning', message: '请选择一张待预测影像上传!'});\r\n      }\r\n      //     }\r\n      //\r\n      // })\r\n    },\r\n\r\n\r\n    //下载预测标签\r\n    download() {\r\n      console.log(this.tifUrlList, \"下载里的this.tifUrlList有什么\" )\r\n      if(this.tifUrlList.length == 0) {\r\n        this.$message({type: 'warning', message: '请先上传待预测影像后再下载标签!'});\r\n      }\r\n      else {\r\n        const link = document.createElement('a')\r\n        // 这里是将链接地址url转成blob地址，\r\n        fetch(this.tifUrlList[0]).then(res => res.blob()).then(blob => {\r\n          link.href = URL.createObjectURL(blob)\r\n          //获取文件名前缀\r\n          var prefix = this.fileName.split(\".\")[0]\r\n          console.log(prefix, \"文件名\")\r\n          // 下载文件的名称及文件类型后缀\r\n          link.download = prefix + \"-unet-label.tif\"\r\n          document.body.appendChild(link)\r\n          link.click()\r\n          //在资源下载完成后 清除占用的缓存资源\r\n          window.URL.revokeObjectURL(link.href)\r\n          document.body.removeChild(link)\r\n          //url列表清空\r\n          this.tifUrlList = \"\"\r\n        })\r\n            .catch(error => {\r\n              console.error('Error fetching data:', error)\r\n            })\r\n      }\r\n\r\n\r\n    }\r\n\r\n\r\n  }\r\n\r\n}\r\n\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.upload-demo {\r\n  justify-content: center;\r\n  //该图层在纵轴上垂直居中\r\n  align-items: center;\r\n}\r\n</style>"],"mappings":";;gEAIIA,mBAAA,CAGM;EAHDC,IAAI,EAAC,QAAQ;EAACC,KAAK,EAAC;iBACvBF,mBAAA,CAAmC;EAAhCE,KAAK,EAAC;AAAqB,I,aAC9BF,mBAAA,CAA+D;EAAzDG,KAA2C,EAA3C;IAAA;IAAA;EAAA;AAA2C,GAAC,QAAM,E;;EAGrDA,KAAgD,EAAhD;IAAA;IAAA;EAAA;AAAgD;gEAWjDH,mBAAA,CAA8B;EAA3BE,KAAK,EAAC;AAAgB;gEACzBF,mBAAA,CAAyD;EAApDE,KAAK,EAAC;AAAiB,I,8BAAC,WAAS,G,aAAAF,mBAAA,CAAa,YAAT,MAAI,E;;EAI7CG,KAAyC,EAAzC;IAAA;IAAA;EAAA;AAAyC;gEACMH,mBAAA,CAA6C;EAA1CE,KAAK,EAAC;AAA+B;gEACrCF,mBAAA,CAA+C;EAA5CE,KAAK,EAAC;AAAiC;;;;;;uBAzBnGE,YAAA,CAgCUC,kBAAA;IAhCDH,KAAK,EAAC,UAAU;IAACC,KAAyD,EAAzD;MAAA;MAAA;MAAA;IAAA;;sBAExB,MAGM,CAHNG,UAGM,EAENN,mBAAA,CAcM,OAdNO,UAcM,GAbJC,YAAA,CAYYC,oBAAA;MAXRP,KAAK,EAAC,aAAa;MACnBQ,MAAM,EAAC,GAAG;MACVC,IAAI,EAAJ,EAAI;MACHC,KAAK,EAAE,CAAC;MACTC,QAAQ,EAAR,EAAQ;MACP,aAAW,EAAE,KAAK;MAClB,WAAS,EAAEC,KAAA,CAAAC,QAAQ;MACnB,WAAS,EAAEC,QAAA,CAAAC,YAAY;MACvB,WAAS,EAAED,QAAA,CAAAE;;wBACd,MAA8B,CAA9BC,UAA8B,EAC9BC,UAAyD,C;;kEAI7DpB,mBAAA,CAGM,OAHNqB,UAGM,GAFJb,YAAA,CAA2Gc,oBAAA;MAAhGC,IAAI,EAAC,SAAS;MAAGC,OAAK,EAAER,QAAA,CAAAS;;wBAAQ,MAAO,C,iBAAP,SAAO,GAAAC,UAA6C,C;;oCAC/FlB,YAAA,CAAgHc,oBAAA;MAArGC,IAAI,EAAC,SAAS;MAAGC,OAAK,EAAER,QAAA,CAAAW;;wBAAU,MAAQ,C,iBAAR,UAAQ,GAAAC,UAA+C,C"},"metadata":{},"sourceType":"module","externalDependencies":[]}